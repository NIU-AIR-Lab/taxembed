---
title: "EmbedPhrasesModel"
author: "AlexanderWold_Z1817662"
date: "6/29/2021"
output: pdf_document
---
```{r}
# load packages
library(reticulate)
library(stringr)
library(tokenizers)
```

```{r, warning = FALSE, message = FALSE}
# load the IRC corpus and process it if necessary
IRCpath <- "/home/alex/Projects/taxembed/data/corpora/rda/irc26.rda"
load(IRCpath)
source("/home/alex/Projects/taxembed/1_creation/process_corpus.R")
irc26 <- prepare_corpus(irc26)
irc26 <- tokenize_corpus(irc26, remove_stopwords = TRUE, remove_tax_stopwords = TRUE)
r_to_py(irc26)
temp <- t[1:50000]
r_to_py(temp)
```


```{python}
# train the phrases model
from gensim.models.phrases import Phrases, Phraser

# train the bigram and trigram
bigram = Phrases(r.temp, threshold = 8)
trigram = Phrases(bigram_irc[r.temp], threshold = 8)
fourgram = Phrases(trigram_irc[bigram_irc[r.temp]], threshold = 8)
fivegram = Phrases(fourgram_irc[trigram_irc[bigram_irc[r.temp]]], threshold = 8)

# save the bigram and the trigram
bigram.save("bigram_irc.pkl")
trigram.save("trigram_irc.pkl")
fourgram.save("fourgram_irc.pkl")
fivegram.save("fivegram_irc.pkl")
```

```{python}
# create example terms
test_grams = [["internal", "revenue"],
              ["internal", "revenue", "service"],
              ["higher", "tax"],
              ["higher", "tax", "rates"],
              ["intellectual", "property"],
              ["intellectual", "property", "rights"],
              ["long-term", "capital", "gain"],
              ["long-term", "capital", "gain", "rate"],
              ["temporary", "assistance"],
              ["temporary", "assistance", "for", "needy", "families"]]
              
all_test_grams = ["internal", "revenue",
                  "internal", "revenue", "service",
                  "higher", "tax",
                  "higher", "tax", "rates",
                  "intellectual", "property",
                  "intellectual", "property", "rights",
                  "long-term", "capital", "gain",
                  "long-term", "capital", "gain", "rate",
                  "temporary", "assistance",
                  "temporary", "assistance", "for", "needy", "families", "tax", "deduction",
                  "volunteer", "income", "tax", "assistance",
                  "coverdell", "education", "savings", "account", "child", "tax", "credit", "tax", "credit", "tax", "deductible"]
              

for ngram in r.temp:
  # print(bigram_irc[ngram])
  print(fivegram_irc[fourgram_irc[trigram_irc[bigram_irc[ngram]]]])
  print()

print(fivegram_irc[fourgram_irc[trigram_irc[bigram_irc[all_test_grams]]]])
```

```{python}
# load model names
bigram_irc = Phrases.load("/home/alex/Projects/taxembed/1_creation/bigram_irc.pkl")
trigram_irc = Phrases.load("/home/alex/Projects/taxembed/1_creation/trigram_irc.pkl")
fourgram_irc = Phrases.load("/home/alex/Projects/taxembed/1_creation/fourgram_irc.pkl")
fivegram_irc = Phrases.load("/home/alex/Projects/taxembed/1_creation/fivegram_irc.pkl")
```


